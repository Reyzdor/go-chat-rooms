<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<title>Go Chat</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			max-width: 600px;
			margin: 40px auto;
		}

		input, button {
			padding: 8px;
			margin: 4px 0;
			width: 100%;
		}

		#chat {
			border: 1px solid #ccc;
			height: 200px;
			overflow-y: auto;
			padding: 8px;
			margin-top: 10px;
		}

		.message {
			margin-bottom: 4px;
		}
	</style>
</head>
<body>

	<h2>Go Chat (Demo)</h2>

	<label>Никнейм</label>
	<input id="nick" placeholder="Введите ник">

	<button onclick="createRoom()">Создать комнату</button>

	<label>Токен комнаты</label>
	<input id="token" placeholder="Вставьте токен">

	<button onclick="joinRoom()">Подключиться</button>

	<hr>

	<div id="chat"></div>

	<input id="message" placeholder="Сообщение">
	<button onclick="sendMessage()">Отправить</button>

	<script>
		let ws = null;

		function createRoom() {
			fetch('/create')
				.then(res => res.json())
				.then(data => {
					document.getElementById('token').value = data.token;
					alert('Комната создана. Токен: ' + data.token);
				});
		}

		function joinRoom() {
			const nick = document.getElementById('nick').value;
			const token = document.getElementById('token').value;

			if (!nick || !token) {
				alert('Введите ник и токен');
				return;
			}

			ws = new WebSocket(`ws://localhost:8080/ws?nick=${nick}&token=${token}`);

			ws.onmessage = (event) => {
				addMessage(event.data);
			};

			ws.onopen = () => {
				addMessage('Вы подключились к комнате');
			};

			ws.onclose = () => {
				addMessage('Соединение закрыто');
			};
		}

		function sendMessage() {
			const input = document.getElementById('message');
			const text = input.value;

			if (!ws || ws.readyState !== WebSocket.OPEN) {
				alert('Нет соединения');
				return;
			}

			ws.send(text);
			input.value = '';
		}

		function addMessage(text) {
			const chat = document.getElementById('chat');
			const div = document.createElement('div');
			div.className = 'message';
			div.textContent = text;
			chat.appendChild(div);
			chat.scrollTop = chat.scrollHeight;
		}
	</script>

</body>
</html>